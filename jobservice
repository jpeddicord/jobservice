#!/usr/bin/python

from gobject import threads_init, MainLoop
from dbus import SystemBus
from dbus.service import BusName, Object as DBusObject, method as DBusMethod
from dbus.mainloop.glib import DBusGMainLoop
from JobService import DBUS_IFACE


# figure out what backends we'll be using


class RootJobService(DBusObject):
    
    @DBusMethod(DBUS_IFACE, in_signature='', out_signature='(sb)',
                sender_keyword='sender', connection_keyword='conn')
    def GetAllJobs(self, sender=None, conn=None):
        """
        Returns all jobs known by the backend(s), along with their states.
        
        Returns struct (
            string name
            boolean running
        )
        """
        pass
    

if __name__ == '__main__':
    DBusGMainLoop(set_as_default=True)
    threads_init()

    srv = RootJobService(
        BusName('com.ubuntu.JobService', bus=SystemBus()),
        '/com/ubuntu/JobService'
    )
    srv.loop = MainLoop()
    srv.loop.run()
